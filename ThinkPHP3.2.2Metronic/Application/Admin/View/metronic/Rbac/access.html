<extend name="Public/base" />

<block name="head-css">
	<link href="__METRONIC__/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="__METRONIC__/assets/css/metro.css" rel="stylesheet">
	<link href="__METRONIC__/assets/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
	<link href="__METRONIC__/assets/font-awesome/css/font-awesome.css" rel="stylesheet">
	<link href="__METRONIC__/assets/css/style.css" rel="stylesheet">
	<link href="__METRONIC__/assets/css/style_responsive.css" rel="stylesheet">
	<link href="__METRONIC__/assets/css/style_default.css" rel="stylesheet" id="style_color">
	<link href="__METRONIC__/assets/fancybox/source/jquery.fancybox.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="__METRONIC__/assets/gritter/css/jquery.gritter.css">
	<link rel="stylesheet" type="text/css" href="__METRONIC__/assets/chosen-bootstrap/chosen/chosen.css">
	<link rel="stylesheet" type="text/css" href="__METRONIC__/assets/bootstrap-wysihtml5/bootstrap-wysihtml5.css">
	<link rel="stylesheet" type="text/css" href="__METRONIC__/assets/bootstrap-datepicker/css/datepicker.css">
	<link rel="stylesheet" type="text/css" href="__METRONIC__/assets/bootstrap-timepicker/compiled/timepicker.css">
	<link rel="stylesheet" type="text/css" href="__METRONIC__/assets/bootstrap-colorpicker/css/colorpicker.css">
	<link rel="stylesheet" href="__METRONIC__/assets/bootstrap-toggle-buttons/static/stylesheets/bootstrap-toggle-buttons.css">
	<link rel="stylesheet" type="text/css" href="__METRONIC__/assets/bootstrap-daterangepicker/daterangepicker.css">
	<link rel="stylesheet" type="text/css" href="__METRONIC__/assets/uniform/css/uniform.default.css">
</block>

<block name="page-header">
<!-- BEGIN PAGE HEADER-->
<div class="row-fluid">
	<div class="span12">
		<!-- BEGIN PAGE TITLE & BREADCRUMB-->	
		<h3 class="page-title">角色权限配置
		</h3>
		<ul class="breadcrumb">
	         <li>
	            <i class="icon-home"></i>
	            <a href="{:U('Index/index')}">首页</a> 
	            <span class="icon-angle-right"></span>
	         </li>
	         <li>
	            <a href="{:U('Rbac/roleList')}">权限管理</a>
	            <span class="icon-angle-right"></span>
	         </li>
	         <li>
	            <a href="{:U('Rbac/roleList')}">角色管理</a>
	            <span class="icon-angle-right"></span>
	         </li>
	         <li>
	            <span>角色权限配置</span>
	         </li>
	      </ul>
		<!-- END PAGE TITLE & BREADCRUMB-->
	</div>
</div>
<!-- END PAGE HEADER-->	
</block>

<block name="page-content">
	<!-- BEGIN PAGE CONTENT-->
	<div class="row-fluid">
	<div class="span12">
	<div class="portlet box blue">
	<div class="portlet-title">
	   <h4><i class="icon-reorder"></i>您正在为角色<span style="color:yellow;font-size:16px;font-weight:bold"> {$rolename} </span>分配权限</h4>
	   <div class="tools">
	      <a href="javascript:;" class="collapse"></a>
	      <a href="#portlet-config" data-toggle="modal" class="config"></a>
	      <a href="javascript:;" class="reload"></a>
	      <a href="javascript:;" class="remove"></a>
	   </div>
	</div>
	<div class="portlet-body form">
	   <!-- BEGIN FORM-->
        <form action="{:U('Rbac/access')}" method="post" class="form-horizontal form-row-seperated">
	    <volist name="nodes_with_access" id="vo">
			<div class="control-group" style="margin-bottom: 0px; border: none; <if condition="$vo.level eq '3'">float: left; padding-bottom: 10px; margin-right: -70px;<else />clear: both; </if>">
				<div class="controls" style="padding-left: {$vo['level']*30}px; margin-left: 0px;">
					<label class="checkbox">
						<div class="checker" id="uniform-undefined">
						    <span>
						        <input type="checkbox" name="checkbox[{$vo.id}]" id="{$vo.id}" pid="{$vo.pid}" level="{$vo.level}" value="" style="opacity: 0;" <if condition="$vo.access eq '1'"> checked="checked"</if> >
						    </span>
						</div> 
						<switch name="vo.level">
			    	    	<case value="1"><span style="color:green">[项目]</span></case>
			    	    	<case value="2"><span style="color:blue">[模块]</span></case>
			    	    	<case value="3"><span style="">[操作]</span></case>
			    	    </switch> {$vo.title}
					</label>
				</div>
			</div>
         </volist>
         <div class="form-actions">
            <button type="submit" class="btn blue"><i class="icon-ok"></i> 保存</button>
         </div>
      </form>
      <!-- END FORM-->
    </div>
    </div>
    </div>
</div>
<!-- END PAGE CONTENT-->
</block>

<block name="foot-js">
	<!-- BEGIN JAVASCRIPTS -->    
	<!-- Load javascripts at bottom, this will reduce page load time -->
	<script src="__METRONIC__/assets/js/jquery-1.8.3.min.js"></script>    
	<script src="__METRONIC__/assets/breakpoints/breakpoints.js"></script>       
	<script src="__METRONIC__/assets/bootstrap/js/bootstrap.min.js"></script>
	<script src="__METRONIC__/assets/js/jquery.blockui.js"></script>
	<script src="__METRONIC__/assets/js/jquery.cookie.js"></script>
	<!-- ie8 fixes -->
	<!--[if lt IE 9]>
	<script src="__METRONIC__/assets/js/excanvas.js"></script>
	<script src="__METRONIC__/assets/js/respond.js"></script>
	<![endif]-->
	<script type="text/javascript" src="__METRONIC__/assets/chosen-bootstrap/chosen/chosen.jquery.min.js"></script>
	<script type="text/javascript" src="__METRONIC__/assets/uniform/jquery.uniform.min.js"></script>
	<script type="text/javascript" src="__METRONIC__/assets/bootstrap-wysihtml5/wysihtml5-0.3.0.js"></script> 
	<script type="text/javascript" src="__METRONIC__/assets/bootstrap-wysihtml5/bootstrap-wysihtml5.js"></script>
	<script type="text/javascript" src="__METRONIC__/assets/bootstrap-toggle-buttons/static/js/jquery.toggle.buttons.js"></script>
	<script type="text/javascript" src="__METRONIC__/assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<script type="text/javascript" src="__METRONIC__/assets/bootstrap-daterangepicker/date.js"></script>
	<script type="text/javascript" src="__METRONIC__/assets/bootstrap-daterangepicker/daterangepicker.js"></script> 
	<script type="text/javascript" src="__METRONIC__/assets/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>  
	<script type="text/javascript" src="__METRONIC__/assets/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>
	<script src="__METRONIC__/assets/js/app.js"></script>     
	<script>
	   function batchCheck(obj) { //勾选/取消勾选某个复选框时，触发批量勾选/取消勾选所有下级复选框
		   $current_id = $(obj).attr('id'); //obj：是当前被点击的复选框
		   //$(obj).attr("checked", $("#uniform-" + $current_id + " span").attr("class"));
		   $current_pid = $(obj).attr('pid');
		   $current_level = $(obj).attr('level');
		   $current_checked = $(obj).attr('checked');
	       
		   $('input[type=checkbox]').each(function() { //递归遍历所有复选框
		       if($(this).attr('pid') == $current_id) {
		    	   $item_span = $("#uniform-" + $(this).attr('id') + " span"); //Metronic后台模板的特性：复选框的外层div的id属性被自动转置为"uniform-复选框的id"。
		    	   $item_input = $("#uniform-" + $(this).attr('id') + " input");
		    	   
		    	   $item_span.attr("class",  $("#uniform-" + $current_id + " span").attr("class"));//当复选框被选中后，其外层span的class属性会被自动置为checked。需要被级联勾选/取消勾选的子复选框保持与被点击复选框的相应属性一致即可。
		    	   $item_input.attr("checked", $current_checked); //需要被级联勾选/取消勾选的子复选框保持与被点击复选框的相应属性一致即可。
		       
		    	   //batchCheck(this); //递归操作
		       }
		   });
	   }
	   
	   jQuery(document).ready(function() {      
	   
	      // to fix chosen dropdown width in inactive hidden tab content
	      $('.advance_form_with_chosen_element').on('shown', function (e) {
	         App.initChosenSelect('.chosen_category:visible');
	      });
	   
	      // initiate layout and plugins
	      App.init();
	      
	    //勾选/取消勾选某个复选框时，触发批量勾选/取消勾选所有下级复选框
	      $('input[type=checkbox]').click(function (){
	          //batchCheck(this);
	      });
	   });
	</script>
	<!-- END JAVASCRIPTS -->  
</block>